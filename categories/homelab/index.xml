<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Homelab on ca4mi</title><link>https://ca4mi.github.io/categories/homelab/</link><description>Recent content in Homelab on ca4mi</description><generator>Hugo -- 0.148.0-DEV</generator><language>en</language><lastBuildDate>Fri, 25 Oct 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://ca4mi.github.io/categories/homelab/index.xml" rel="self" type="application/rss+xml"/><item><title>Running Windows VMs using dockurr/windows</title><link>https://ca4mi.github.io/posts/2024-10-25-windows-wms/</link><pubDate>Fri, 25 Oct 2024 00:00:00 +0000</pubDate><guid>https://ca4mi.github.io/posts/2024-10-25-windows-wms/</guid><description>How to use Docker VMs to run various Windows environments within a Linux-based OS, like Fedora. Sometimes need to access to different Windows versions (7, 10, 11) for testing or other office/work related purposes. Manually installing and managing these versions can be cumbersome. This solution leverages podman with podman-compose and the `dockurr/windows` image to streamline the process.</description><content:encoded><![CDATA[<h4 id="sources">Sources</h4>
<ul>
<li><a href="https://youtu.be/xhGYobuG508">https://youtu.be/xhGYobuG508</a> /Running Windows in a Docker Container! - Wolfgang&rsquo;s Channel/</li>
<li><a href="https://bobpony.com/downloads/">https://bobpony.com/downloads/</a> /Download ISO images/</li>
<li><a href="https://github.com/dockur/windows">https://github.com/dockur/windows</a> /Github repo/</li>
</ul>
<h4 id="docker-composeyml-example">docker-compose.yml example:</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.2&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">win7</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dockurr/windows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">windows-7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RAM_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">CPU_CORES</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DISK_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;20G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">devices</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/dev/kvm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">NET_ADMIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8007</span><span class="p">:</span><span class="m">8006</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3387</span><span class="p">:</span><span class="m">3389</span><span class="l">/tcp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3387</span><span class="p">:</span><span class="m">3389</span><span class="l">/udp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./data-7:/storage:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/path/windows-7.iso:/custom.iso:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">stop_grace_period</span><span class="p">:</span><span class="w"> </span><span class="l">2m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">win10</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dockurr/windows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">windows-10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RAM_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">CPU_CORES</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DISK_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">devices</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/dev/kvm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">NET_ADMIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8010</span><span class="p">:</span><span class="m">8006</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3310</span><span class="p">:</span><span class="m">3389</span><span class="l">/tcp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3310</span><span class="p">:</span><span class="m">3389</span><span class="l">/udp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./data-10:/storage:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/path/windows-10.iso:custom.iso:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">stop_grace_period</span><span class="p">:</span><span class="w"> </span><span class="l">2m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">win11</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dockurr/windows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">windows-11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RAM_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;8G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">CPU_CORES</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DISK_SIZE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">devices</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/dev/kvm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">NET_ADMIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8011</span><span class="p">:</span><span class="m">8006</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3311</span><span class="p">:</span><span class="m">3389</span><span class="l">/tcp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3311</span><span class="p">:</span><span class="m">3389</span><span class="l">/udp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./data-11:/storage:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/path/windows-11.iso:/custom.iso:Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">stop_grace_period</span><span class="p">:</span><span class="w"> </span><span class="l">2m  </span><span class="w">
</span></span></span></code></pre></div><p><strong>Explanation:</strong>
This <code>docker-compose.yml</code> file defines three Windows VMs, each running a different OS (Windows 7, 10, and 11). The <code>dockurr/windows</code> image handles the automatic downloading and installation of the OS during runtime. However, this setup uses ISO images for each VM. Each VM&rsquo;s configuration specifies:</p>
<ul>
<li><strong>Resource Allocation:</strong> RAM (<code>RAM_SIZE</code>), CPU cores (<code>CPU_CORES</code>), and disk space (<code>DISK_SIZE</code>)</li>
<li><strong>Devices:</strong> <code>/dev/kvm</code> is required for KVM virtualization.</li>
<li><strong>Capabilities:</strong>  <code>NET_ADMIN</code> allows network administration within the container.</li>
<li><strong>Ports:</strong> Different ports are mapped for each VM on the host machine to allow access to RDP (Remote Desktop Protocol).</li>
<li><strong>Volumes:</strong> Volumes are used to persist data specific to each VM.
You can check each details from here: <a href="https://github.com/dockur/windows">https://github.com/dockur/windows</a></li>
</ul>
<h4 id="connecting-to-the-vms">Connecting to the VMs</h4>
<p>Use <code>xfreerdp</code> to connect to the Windows VMs</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xfreerdp /u:docker /p: /v:127.0.0.1:&lt;tcp port&gt; /clipboard
</span></span><span class="line"><span class="cl"><span class="c1"># for example:</span>
</span></span><span class="line"><span class="cl">xfreerdp /u:docker /p: /v:127.0.0.1:3387 /clipboard <span class="c1">#win 7</span>
</span></span><span class="line"><span class="cl">xfreerdp /u:docker /p: /v:127.0.0.1:3310 /clipboard <span class="c1">#win 10</span>
</span></span><span class="line"><span class="cl">xfreerdp /u:docker /p: /v:127.0.0.1:3311 /clipboard <span class="c1">#win 11</span>
</span></span></code></pre></div>]]></content:encoded></item><item><title>Tailscale VPN(mesh) + Cloudflare + NextDNS + Nignx Proxy Manager (Let's Encrypt) SSL certificate тохируулах</title><link>https://ca4mi.github.io/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/</link><pubDate>Thu, 28 Mar 2024 00:00:00 +0000</pubDate><guid>https://ca4mi.github.io/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/</guid><description>&lt;p>Note: Дээрх аргаас гадна өөр олон арга ашиглан vpn үүсгэх, тохируулах боломжтой.&lt;/p>
&lt;h3 id="domain-худалдан-авах">Domain худалдан авах&lt;/h3>
&lt;p>Энэ удаа hover.com-с domain аван тохируулга хийнэ. Нэвтрэн ороод авах гэж domain нэрээр хайлт хийнэ. Гарч ирсэн утгуудаас сонголт хийн худалдан авна. Domain, нэг жилдээ хямдхан, дараа жилээс үнэ нь 10 хэд дахин өсдөг тул сунгалт хийхэд үнийн өсөлт бага байхаар худалдан авалт хийгээрэй.
&lt;img alt="Hover.com domain pick" loading="lazy" src="https://ca4mi.github.io/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325000838.png">
&lt;code>hosono.space&lt;/code> нэртэй domain худалдан авлаа.&lt;/p>
&lt;h4 id="domain-dns">Domain DNS&lt;/h4>
&lt;p>hosono.space domain-н тохироо дах DNS хэсэгт доорх байдлаар тохируулга хийнэ:
&lt;img alt="Hover.com domain DNS" loading="lazy" src="https://ca4mi.github.io/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325001442.png">&lt;/p></description><content:encoded><![CDATA[<p>Note: Дээрх аргаас гадна өөр олон арга ашиглан vpn үүсгэх, тохируулах боломжтой.</p>
<h3 id="domain-худалдан-авах">Domain худалдан авах</h3>
<p>Энэ удаа hover.com-с domain аван тохируулга хийнэ. Нэвтрэн ороод авах гэж domain нэрээр хайлт хийнэ. Гарч ирсэн утгуудаас сонголт хийн худалдан авна. Domain, нэг жилдээ хямдхан, дараа жилээс үнэ нь 10 хэд дахин өсдөг тул сунгалт хийхэд үнийн өсөлт бага байхаар худалдан авалт хийгээрэй.
<img alt="Hover.com domain pick" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325000838.png">
<code>hosono.space</code> нэртэй domain худалдан авлаа.</p>
<h4 id="domain-dns">Domain DNS</h4>
<p>hosono.space domain-н тохироо дах DNS хэсэгт доорх байдлаар тохируулга хийнэ:
<img alt="Hover.com domain DNS" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325001442.png"></p>
<table>
  <thead>
      <tr>
          <th>TYPE</th>
          <th>HOST</th>
          <th>VALUE</th>
          <th>TTL</th>
          <th>ADDED BY</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>*</td>
          <td>216.40.34.41</td>
          <td>15 Minutes</td>
          <td>Hover</td>
      </tr>
      <tr>
          <td>A</td>
          <td>@</td>
          <td>216.40.34.41</td>
          <td>15 Minutes</td>
          <td>Hover</td>
      </tr>
      <tr>
          <td>MX</td>
          <td>@</td>
          <td>10 mx.hover.com.cust.hostedemail.com</td>
          <td>15 Minutes</td>
          <td>Hover</td>
      </tr>
      <tr>
          <td>CNAME</td>
          <td>mail</td>
          <td>mail.hover.com.cust.hostedemail.com</td>
          <td>15 Minutes</td>
          <td>Hover</td>
      </tr>
  </tbody>
</table>
<p><code>MX</code>, <code>CNAME</code> тохируулга хийхгүй байж болно.</p>
<h4 id="domain-nameserver">Domain Nameserver</h4>
<p>Overview хэсэг дах Nameserver хэсэгт edit хийнэ
<img alt="Edit Nameserver" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325004547.png">
<code>ridge.ns.cloudflare.com</code>, <code>tess.ns.cloudflare.com</code> оруулан save хийнэ.</p>
<h3 id="cloudflare-д-бүртгүүлэх--тохируулах">Cloudflare-д бүртгүүлэх &amp; тохируулах</h3>
<h4 id="dns-records">DNS Records</h4>
<p>Cloudflare.com хаягаар орон бүртгэлгүй бол шинээр бүртгүүлнэ. Нэвтрэн ороод Websites хэсгээр орон <code>Add a site</code> дээр даран өмнө авсан domain нэрээ оруулаарай. <code>DNS</code> цэсээр орон Records бүртгэл хийнэ.
<img alt="Cloudflare add DNS records for domain" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325003911.png"></p>
<table>
  <thead>
      <tr>
          <th>Type</th>
          <th>Name</th>
          <th>Content</th>
          <th>Proxy Status</th>
          <th>TLL</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>*</td>
          <td>216.40.34.41</td>
          <td>Proxied</td>
          <td>Auto</td>
      </tr>
      <tr>
          <td>A</td>
          <td>hosono.space</td>
          <td>216.40.34.41</td>
          <td>Proxied</td>
          <td>Auto</td>
      </tr>
      <tr>
          <td>A</td>
          <td>www</td>
          <td>216.40.34.41</td>
          <td>Proxied</td>
          <td>Auto</td>
      </tr>
  </tbody>
</table>
<h4 id="api-token-авах">API Token авах</h4>
<p>Overview цэсээс доошлуулаад харвал API гэсэн хэсэг байгаа Get your IP token дээр дарна.
<img alt="Cloudflare get API Token" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325171509.png"></p>
<p><code>Edit zone DNS</code> дэх use template -г сонгоно.
<img alt="Edit zone DNS" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325174231.png">
Нэр, Permission, Zone Resources -г доорх зургийн дагуу тохируулаад <code>Contiune and summary</code> дарна.
<img alt="Edit zone DNS" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325173045.png">
Permissions:
<code>Zone</code>, <code>DNS</code>, <code>Edit</code>
Zone Resources
<code>Include</code>, <code>All Zones</code></p>
<p>Create Token дарна:
<img alt="Create Token" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325174717.png"></p>
<p><code>gjeuX3Jw8zXCCohha11N9zauX4y02XVx8ZrmY5Nt</code> token-гоо хуулж аваарай. Бусдад дамжуулах ил газар хуулаад хэрэггүй юм.
<img alt="Copy token" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325174908.png">
Note: Жишээ энэ token-г устгасан болно.</p>
<h3 id="nignx-proxy-manager">Nignx Proxy Manager</h3>
<h4 id="npm">NPM</h4>
<p>NPM суулгах заавартай <a href="https://ca4mi.github.io/posts/2024-01-18-docker-thinkpadr500/">энд</a> даран дэлгэрүүлэн үзнэ үү. Товчоор бол <code>docker-compose.yml</code> дотор жишээ нь:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.2&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nginxproxymanager</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;jc21/nginx-proxy-manager:latest&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">nginxproxymanager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;80:80&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;81:81&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;443:443&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nginx/data:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nginx/letsencrypt:/etc/letsencrypt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># default cred: admin@example.com, changeme</span><span class="w">
</span></span></span></code></pre></div><p>суулгаад <code>localhost:81</code> -р хандан default creds хандалт хийнэ.</p>
<h4 id="lets-encrypt---cloudflare">Let&rsquo;s Encrypt - Cloudflare</h4>
<p><code>SSL Certificates</code> -&gt;  <code>Add SSL Certificate</code> -&gt; <code>Let's Encrypt</code> сонгоно.
<img alt="Add SSL - Let&rsquo;s Encrypt" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240325180527.png"></p>
<table>
  <thead>
      <tr>
          <th>Талбар</th>
          <th>Тайлбар</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Domain Names</td>
          <td>Эхэнд авсан domain-г бичин оруулна. <code>*.hosono.space</code> г.м</td>
      </tr>
      <tr>
          <td>Email Address for Let&rsquo;s Encrypt</td>
          <td>Certificates хугацаа дуусах үед мэдэгдэл авах мэйл хаяг бичин тохируулна</td>
      </tr>
      <tr>
          <td>Use a DNS Challenge</td>
          <td>Үүнийг чагтлах</td>
      </tr>
      <tr>
          <td>DNS Provider</td>
          <td>Cloudflare -г сонгоно</td>
      </tr>
      <tr>
          <td>Credentials File Content</td>
          <td>Cloudflares-с авсан API token-г 1234 гэсэн тоон утгийн оронд солин оруулна</td>
      </tr>
      <tr>
          <td>Propagation Seconds</td>
          <td>Хоосон орхиж болно</td>
      </tr>
      <tr>
          <td>I Agree</td>
          <td>Үүнийг чагтлах</td>
      </tr>
  </tbody>
</table>
<p>Credentials File Content:</p>
<pre tabindex="0"><code>dns_cloudflare_api_token = &lt;Cloudflare API token байна&gt;
</code></pre><h4 id="proxy-hosts">Proxy Hosts</h4>
<p>Add proxy hosts дээр даран жишээ нь jellyfin-г тохируулж буйг зургаас харна уу. Domain name хэсэгт хандах subdomain бичнэ. Scheme, IP, forward port-ууд тухайн container-н тохиргооноос хамааран өөр байна. Jellyfin-н default port: 8096, docker-compose дотор container name нь jellyfin ба compose нэг network-д тул container name-г хандалт хийж болох юм г.м.
<img alt="Proxy Hosts" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328155401.png"></p>
<p>SSL цэсээр орон SSL Certificate талбарт өмнө үүсгэсэн <code>*.hosono.space</code> -г сонгоод <code>force SSL</code>, <code>HTTPS Support</code> сонгон save хийнэ.
<img alt="Proxy Hosts" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328155453.png"></p>
<p>Энэ мэтээр proxy hosts тохируулах юм.</p>
<h3 id="tailscale--nextdns">Tailscale &amp; NextDNS</h3>
<p><a href="https://tailscale.com">Tailscale</a> бүртгэлгүй бол бүртгүүлээд сервер дээрээ <a href="https://tailscale.com/kb/1347/installation">script</a> ашиглан суулгаад machine бүртгэл хийгээд approve хийсэн бол доорх зураг шиг харагдана.
<img alt="Tailscale dashbaord" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328161357.png"></p>
<p><a href="https://nextdns.io">NextDNS</a> бүртгэлгүй бол бүртгүүлээд Endpoints хэсэг дэх ID хуулна. Tailscale-н dashbaord руу буцан ороод DNS цэсээр орон <code>Add nameserver</code> дээр даран <code>NextDNS</code>-г сонгоно.
<img alt="Add nameserver" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328163003.png"></p>
<p>Гарч ирсэн цонхонд NextDNS-н Endpoints хэсэг дэх ID-г оруулан save. Дараа нь <code>Override local DNS</code> -г on болгоно.
<img alt="NextDNS endpoints" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328163200.png"></p>
<p>Үүний дараа NextDNS <a href="https://my.nextdns.io/">тохиргоон</a> дах Settings хэсэг дах Rewrites-д <code>New rewrite</code> оруулна.
<img alt="NextDNS rewrites" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328164037.png">
Domain талбарт <code>hosono.space</code>, Answer хэсэгт tailscale-н machine IP address оруулан save. Save хийсэн бол дараах байдалтай харагдана.
<img alt="NextDNS rewrites sample" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328164305.png">
Tailscale -г on болгоод <code>https://jellyfin.hosono.space</code> руу хандан, SSL Cert шалгавал:
<img alt="Shown SSL Cert on jellyfin" loading="lazy" src="/posts/2024-03-28-ssl-cert-using-npm-tailscale-cloudflare+nextdns/images/20240328160211.png"></p>
]]></content:encoded></item><item><title>Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS</title><link>https://ca4mi.github.io/posts/2024-01-18-docker-thinkpadr500/</link><pubDate>Thu, 18 Jan 2024 00:00:00 +0000</pubDate><guid>https://ca4mi.github.io/posts/2024-01-18-docker-thinkpadr500/</guid><description>Nginx Proxy Manager + DuckDNS + Containers</description><content:encoded><![CDATA[<h4 id="os">OS</h4>
<p>Almalinux 8.9 minimal <a href="https://mirrors.almalinux.org/isos/x86_64/8.9.html">ISO</a> суулгасан. Суулгах явцад root-с тусад нь user үүсгэн wheel группд нэмсэн.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># hostnamectl</span>
</span></span><span class="line"><span class="cl">         Icon name: computer-laptop
</span></span><span class="line"><span class="cl">           Chassis: laptop
</span></span><span class="line"><span class="cl">  Operating System: AlmaLinux 8.9 <span class="o">(</span>Midnight Oncilla<span class="o">)</span>
</span></span><span class="line"><span class="cl">       CPE OS Name: cpe:/o:almalinux:almalinux:8::baseos
</span></span><span class="line"><span class="cl">            Kernel: Linux 4.18.0-513.9.1.el8_9.x86_64
</span></span><span class="line"><span class="cl">      Architecture: x86-64
</span></span><span class="line"><span class="cl"><span class="c1"># lshw</span>
</span></span><span class="line"><span class="cl">    vendor: LENOVO
</span></span><span class="line"><span class="cl">    version: ThinkPad R500
</span></span><span class="line"><span class="cl">    cpu: Celeron<span class="o">(</span>R<span class="o">)</span> Dual-Core CPU T3100 @ 1.90GHz
</span></span><span class="line"><span class="cl">    ram: 8G DDR2 800MHz
</span></span></code></pre></div><h4 id="docker--docker-compose">Docker &amp; docker compose</h4>
<p>Суулгах</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dnf upgrade
</span></span><span class="line"><span class="cl">sudo dnf install yum-utils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Complete бол сервис асаана</span>
</span></span><span class="line"><span class="cl">sudo systemctl start docker
</span></span><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check version</span>
</span></span><span class="line"><span class="cl">docker --version
</span></span><span class="line"><span class="cl"><span class="c1"># Docker version 24.0.7, build afdd53b</span>
</span></span><span class="line"><span class="cl">docker-compose --version
</span></span><span class="line"><span class="cl"><span class="c1"># Docker Compose version v2.12.2</span>
</span></span></code></pre></div><p>Compose ажиллахгүй бол энэ аргаар суулгана:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L <span class="s2">&#34;https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-</span><span class="k">$(</span>uname -s<span class="k">)</span><span class="s2">-</span><span class="k">$(</span>uname -m<span class="k">)</span><span class="s2">&#34;</span> -o /usr/bin/docker-compose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chmod +x /usr/bin/docker-compose
</span></span></code></pre></div><p>Non root user бол docker group үүсгээд sudo үүсгэх боломжтой болгоорой.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Add alma user to wheel group</span>
</span></span><span class="line"><span class="cl">sudo usermod -aG wheel alma
</span></span><span class="line"><span class="cl"><span class="c1"># Add alma user to docker group</span>
</span></span><span class="line"><span class="cl">sudo usermod -aG docker alma
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># groups</span>
</span></span><span class="line"><span class="cl">alma wheel docker
</span></span><span class="line"><span class="cl"><span class="c1"># id</span>
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>alma<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>alma<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>alma<span class="o">)</span>,10<span class="o">(</span>wheel<span class="o">)</span>,992<span class="o">(</span>docker<span class="o">)</span>
</span></span></code></pre></div><h4 id="docker-compose">Docker compose</h4>
<p><a href="https://nginxproxymanager.com/">nginxproxymanager</a>, <a href="https://nextcloud.com/">nextcloud</a>, <a href="https://www.home-assistant.io/">homeassistant</a>, <a href="https://jellyfin.org/">jellyfin</a>, <a href="https://github.com/bitnami/containers/blob/main/bitnami/odoo/docker-compose.yml">odoo+postgres</a>, <a href="https://www.navidrome.org/">navidrome</a> docker compose бүрдэнэ. Nginx proxy manager дээр HTTPS (Let&rsquo;s encrypt) авахад бас <a href="https://www.duckdns.org/">DuckDNS</a> domain авахад ашиглана. Docker network-оо дундаа ашиглана. 3 port docker -с host руу 80, 81, 443 expose хийсэн.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.2&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nginxproxymanager</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;jc21/nginx-proxy-manager:latest&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">nginxproxymanager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;80:80&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;81:81&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;443:443&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nginx/data:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nginx/letsencrypt:/etc/letsencrypt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># default cred: admin@example.com, changeme</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nextcloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">lscr.io/linuxserver/nextcloud:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">nextcloud</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Ulaanbaatar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nextcloud/appdata:/config </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./nextcloud/data:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">homeassistant</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">lscr.io/linuxserver/homeassistant:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">homeassistant </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Ulaanbaatar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./hass/config:/config </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">jellyfin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">lscr.io/linuxserver/jellyfin:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">jellyfin </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Ulaanbaatar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./jellyfin/config:/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./jellyfin/tvshows:/data/tvshows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./jellyfin/movies:/data/movies </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">postgresql</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/bitnami/postgresql:16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">postgresql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Ulaanbaatar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ALLOW_EMPTY_PASSWORD=yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRESQL_USERNAME=bn_odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRESQL_DATABASE=bitnami_odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./postgresql/postgresql-persistence:/bitnami/postgresql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">odoo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/bitnami/odoo:17</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Ulaanbaatar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ALLOW_EMPTY_PASSWORD=yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ODOO_DATABASE_HOST=postgresql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ODOO_DATABASE_PORT_NUMBER=5432</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ODOO_DATABASE_USER=bn_odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ODOO_DATABASE_NAME=bitnami_odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./odoo/odoo-persistence:/bitnami/odoo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">postgresql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># default cred: user@example.com, bitnami</span><span class="w">
</span></span></span></code></pre></div><p>Compose run:</p>
<pre tabindex="0"><code>docker-compose up -d
</code></pre><p><code>docker ps</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CONTAINER ID   IMAGE                                      COMMAND                  CREATED         STATUS                   PORTS                                                                                  NAMES
</span></span><span class="line"><span class="cl">0f35e9aafd25   bitnami/odoo:17                            <span class="s2">&#34;/opt/bitnami/script…&#34;</span>   <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             3000/tcp, 8069/tcp, 8072/tcp                                                           odoo
</span></span><span class="line"><span class="cl">91faa3c03087   lscr.io/linuxserver/homeassistant:latest   <span class="s2">&#34;/init&#34;</span>                  <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             8123/tcp                                                                               homeassistant
</span></span><span class="line"><span class="cl">a2aa28911120   lscr.io/linuxserver/nextcloud:latest       <span class="s2">&#34;/init&#34;</span>                  <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             80/tcp, 443/tcp                                                                        nextcloud
</span></span><span class="line"><span class="cl">89039950eded   bitnami/postgresql:16                      <span class="s2">&#34;/opt/bitnami/script…&#34;</span>   <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             5432/tcp                                                                               postgresql
</span></span><span class="line"><span class="cl">a2c89d8405bf   jc21/nginx-proxy-manager:latest            <span class="s2">&#34;/init&#34;</span>                  <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             0.0.0.0:80-81-&gt;80-81/tcp, :::80-81-&gt;80-81/tcp, 0.0.0.0:443-&gt;443/tcp, :::443-&gt;443/tcp   nginxproxymanager
</span></span><span class="line"><span class="cl">029423ea3e20   lscr.io/linuxserver/jellyfin:latest        <span class="s2">&#34;/init&#34;</span>                  <span class="m">6</span> minutes ago   Up <span class="m">6</span> minutes             8096/tcp, 8920/tcp                                                                     jellyfin
</span></span></code></pre></div><h4 id="port-нээх">Port нээх</h4>
<p>docker expose хийсэн портуудыг хост талдаа нээнэ.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Host port нээх</span>
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --add-service<span class="o">=</span>http --permanent
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --add-port 8080/tcp --permanent
</span></span><span class="line"><span class="cl"><span class="c1"># reload хийх</span>
</span></span><span class="line"><span class="cl">sudo firewall-cmd --reload
</span></span><span class="line"><span class="cl"><span class="c1"># port шалгах</span>
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --list-ports
</span></span></code></pre></div><h3 id="host-д-persist-хийгдсэн-volume">Host-д persist хийгдсэн volume</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#pwd</span>
</span></span><span class="line"><span class="cl">/home/alma/docker/compose
</span></span><span class="line"><span class="cl"><span class="c1">#ls -la -d * */*</span>
</span></span><span class="line"><span class="cl">-rw-rw-r--. <span class="m">1</span> alma             alma <span class="m">2022</span> Jan <span class="m">18</span> 00:59 docker-compose.yml
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">3</span> root             root   <span class="m">20</span> Jan  <span class="m">6</span> 01:49 hass
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">8</span> alma             alma <span class="m">4096</span> Jan <span class="m">18</span> 01:21 hass/config
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">5</span> root             root   <span class="m">49</span> Jan  <span class="m">6</span> 01:49 jellyfin
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">6</span> alma             alma  <span class="m">179</span> Jan <span class="m">16</span> 09:28 jellyfin/config
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">2</span> alma             alma <span class="m">4096</span> Jan <span class="m">14</span> 07:43 jellyfin/movies
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">4</span> alma             alma   <span class="m">54</span> Jan <span class="m">14</span> 07:43 jellyfin/tvshows
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">4</span> root             root   <span class="m">33</span> Jan  <span class="m">6</span> 01:49 nextcloud
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">7</span> alma             alma   <span class="m">95</span> Jan  <span class="m">6</span> 02:30 nextcloud/appdata
</span></span><span class="line"><span class="cl">drwxrwx---. <span class="m">5</span> alma             alma  <span class="m">158</span> Jan <span class="m">18</span> 06:30 nextcloud/data
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">4</span> root             root   <span class="m">37</span> Jan  <span class="m">6</span> 01:49 nginx
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">7</span> root             root  <span class="m">137</span> Jan <span class="m">18</span> 06:02 nginx/data
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">8</span> root             root  <span class="m">104</span> Jan <span class="m">18</span> 06:02 nginx/letsencrypt
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">3</span> root             root   <span class="m">30</span> Jan <span class="m">17</span> 23:28 odoo
</span></span><span class="line"><span class="cl">drwxrwxr-x. <span class="m">5</span> systemd-coredump root   <span class="m">44</span> Jan <span class="m">18</span> 01:01 odoo/odoo-persistence
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">3</span> root             root   <span class="m">36</span> Jan <span class="m">18</span> 00:54 postgresql
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">3</span>             <span class="m">1001</span> <span class="m">1001</span>   <span class="m">18</span> Jan <span class="m">18</span> 00:58 postgresql/postgresql-persistence
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">4</span> root             root   <span class="m">31</span> Mar  <span class="m">2</span> 15:02 navidrome
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">3</span> root             root   <span class="m">87</span> Mar  <span class="m">2</span> 15:02 navidrome/data
</span></span><span class="line"><span class="cl">drwxr-xr-x. <span class="m">2</span> root             root    <span class="m">6</span> Mar  <span class="m">2</span> 15:02 navidrome/music
</span></span></code></pre></div><p>non-root container-н хувьд permission алдаа заавал, жишээ нь postgresql:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo chown -R 1001:1001 postgresql/postgresql-persistence
</span></span></code></pre></div><p>Permission denied хийж байвал:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># jellyfin</span>
</span></span><span class="line"><span class="cl">sudo chown -R alma:alma movies
</span></span><span class="line"><span class="cl">sudo chmod -R <span class="m">755</span> movies <span class="c1">#tvshows</span>
</span></span></code></pre></div><h3 id="nginx-proxy-manager">Nginx proxy manager</h3>
<p><code>http://server-ip:81</code> хандан default creds-р (<code>admin@example.com</code> pass: <code>changeme</code>) нэвтэрнэ. Дараа нь <a href="https://duckdns.org/">DuckDNS</a> бүртгүүлээд sub domain (жишээ нь <code>hosono</code>.duckdns.org г.м) авна. <code>Current IP</code> хэсэгт host-н IP (192.168.1.200 г.м) save хийнэ дээд хэсэгт <code>token</code> -copy хийнэ.</p>
<p>Nginx proxy manager -&gt; SSL Certificate -&gt; Add Let&rsquo;s Encrypt Certificate -&gt;  Let&rsquo;s Encrypt орон Domain Names хэсэгт DuckDNS авсан domain-аа (<code>*.hosono.duckdns.org</code> болон <code>hosono.duckdns.org</code>) оруулна. Email хэсэгт мэдэгдэл авах мэйл хаягаа оруулна. Use a DNS Challenge -г enable хийгээд <code>DuckDNS</code> сонгоод <code>dns_duckdns_token=өмнө copy хийсэн token-oo энд paste хийнэ</code>. Propagation Seconds хэсэгт <code>120</code> гэж бичээд save. Алдаа заавал дахин save хийнэ.</p>
<h4 id="proxy-entry">Proxy entry</h4>
<p><code>hosono.duckdns.org</code> -г <code>http://nginxproxymanager:81</code>
<code>jellyfin.hosono.duckdns.org</code> -г <code>http://jellyfin:8096</code> гэх мэтээр Certificate тохируулахад Proxy host-ууд бүртгэнэ.</p>
<p>Domain Names хэсэгт бүртгэж буй sub domain-аа бичин, Scheme хэсэгт <code>http</code> <code>https</code> -с сонгоно. container талаас 443 default хийгдээгүй л бол ихэхндээ <code>http</code> -г сонгоно.  Forward Hostname / IP хэсэгт container name эсхүл 127.0.0.1 байж болно.</p>
<p>SSL хэсэгт SSL Certificate -д бүртгэсэн DuckDNS -с сонгоод Force SSL, HTTP/2 Support гэдгийг сонгоод хадаглах юм. Энэ мэтээр subdomain -уудаа бүртгэнэ.</p>
<table>
  <thead>
      <tr>
          <th>SOURCE</th>
          <th>DESTINATION</th>
          <th>SSL</th>
          <th>ACCESS</th>
          <th>STATUS</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>home.hosono.duckdns.org</td>
          <td>http://homeassistant:8123</td>
          <td>Let&rsquo;s Encrypt</td>
          <td>Public</td>
          <td>Online</td>
      </tr>
      <tr>
          <td>hosono.duckdns.org</td>
          <td>http://nginxproxymanager:81</td>
          <td>Let&rsquo;s Encrypt</td>
          <td>Public</td>
          <td>Online</td>
      </tr>
      <tr>
          <td>jellyfin.hosono.duckdns.org</td>
          <td>http://jellyfin:8096</td>
          <td>Let&rsquo;s Encrypt</td>
          <td>Public</td>
          <td>Online</td>
      </tr>
      <tr>
          <td>nextcloud.hosono.duckdns.org</td>
          <td>https://nextcloud:443</td>
          <td>Let&rsquo;s Encrypt</td>
          <td>Public</td>
          <td>Online</td>
      </tr>
      <tr>
          <td>odoo.hosono.duckdns.org</td>
          <td>http://odoo:8069</td>
          <td>Let&rsquo;s Encrypt</td>
          <td>Public</td>
          <td>Online</td>
      </tr>
  </tbody>
</table>
<h5 id="ha">HA</h5>
<p>http://homeassistant:8123 хувьд Proxy бүртгэх дээ Websockets Supports гэдгийг чагтлан өгнө. Дараа нь npm ажиллаж байгаа IP хаягийн мэдээллийг аван HASS дотор configuration.yml -г trusted_proxy хэсэгт npm нэмэн оруулна</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker inspect nginxproxymanager
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;172.23.0.2&#34;</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># /home/user/docker/compose/hass/config</span>
</span></span><span class="line"><span class="cl">vi configuration.yaml
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">http:
</span></span><span class="line"><span class="cl">  use_x_forwarded_for: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  trusted_proxies:
</span></span><span class="line"><span class="cl">    - 172.23.0.0/24
</span></span><span class="line"><span class="cl">  <span class="c1"># - 172.23.0.5</span>
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><p>configuration.yaml save хийгээд homeassistant restart хийнэ:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker restart homeassistant
</span></span></code></pre></div><h3 id="watchtower">Watchtower</h3>
<p>Гараар container-ууд update хийнэ.
/Docker-compose дотор байнга ажилладаг байхаар тохируулж бас болно/</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -v /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower --run-once
</span></span></code></pre></div><h3 id="bookmarks">Bookmarks</h3>
<ul>
<li><a href="https://youtu.be/qlcVx-k-02E">https://youtu.be/qlcVx-k-02E</a></li>
<li><a href="https://notthebe.ee/blog/easy-ssl-in-homelab-dns01/">https://notthebe.ee/blog/easy-ssl-in-homelab-dns01/</a></li>
<li><a href="https://github.com/bitnami/containers/tree/main/bitnami/odoo#configuration">https://github.com/bitnami/containers/tree/main/bitnami/odoo#configuration</a></li>
<li><a href="https://linux.how2shout.com/how-to-open-or-close-ports-in-almalinux-8-or-rocky-firewall/">https://linux.how2shout.com/how-to-open-or-close-ports-in-almalinux-8-or-rocky-firewall/</a></li>
<li><a href="https://techoverflow.net/2020/01/28/how-to-fix-bitnami-mariadb-mkdir-cannot-create-directory-bitnami-mariadb-permission-denied/">https://techoverflow.net/2020/01/28/how-to-fix-bitnami-mariadb-mkdir-cannot-create-directory-bitnami-mariadb-permission-denied/</a></li>
<li><a href="https://github.com/containrrr/watchtower/discussions/901">https://github.com/containrrr/watchtower/discussions/901</a></li>
<li><a href="https://containrrr.dev/watchtower/">https://containrrr.dev/watchtower/</a></li>
<li><a href="https://github.com/navidrome/navidrome">https://github.com/navidrome/navidrome</a></li>
</ul>
]]></content:encoded></item></channel></rss>